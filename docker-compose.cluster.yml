services:
  z4-node1:
    build: .
    container_name: z4-node1
    ports:
      - "9670:9670"
      - "9671:9671"
    volumes:
      - ./data/node1:/app/data
    environment:
      - Z4_ENCRYPTION_KEY=${Z4_ENCRYPTION_KEY:-}
    command: ["/app/z4", "server", "--id", "node1", "--port", "9670", "--gossip-port", "9671"]
    networks:
      - z4net
    restart: unless-stopped

  z4-node2:
    build: .
    container_name: z4-node2
    ports:
      - "8082:9670"
      - "8083:9671"
    volumes:
      - ./data/node2:/app/data
    environment:
      - Z4_ENCRYPTION_KEY=${Z4_ENCRYPTION_KEY:-}
    command: ["/app/z4", "server", "--id", "node2", "--port", "9670", "--gossip-port", "9671", "--join", "z4-node1:9671"]
    depends_on:
      - z4-node1
    networks:
      - z4net
    restart: unless-stopped

  z4-node3:
    build: .
    container_name: z4-node3
    ports:
      - "8084:9670"
      - "8085:9671"
    volumes:
      - ./data/node3:/app/data
    environment:
      - Z4_ENCRYPTION_KEY=${Z4_ENCRYPTION_KEY:-}
    command: ["/app/z4", "server", "--id", "node3", "--port", "9670", "--gossip-port", "9671", "--join", "z4-node1:9671"]
    depends_on:
      - z4-node1
    networks:
      - z4net
    restart: unless-stopped

networks:
  z4net:
    driver: bridge
